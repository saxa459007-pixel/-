<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RPG Stats & Books</title>
    <script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>
    <style>
        :root {
            --bg-color: #34383d;
            --card-bg: #3f444b;
            --nav-bg: #2b2e33;
            --text-main: #ffffff;
            --text-secondary: #b0b3b8;
            --accent: #5865F2;
            --input-bg: #4a5059;
            --separator-color: #4a5057;
            --gold: #ffd700;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            user-select: none;
            min-height: 100vh;
            -webkit-tap-highlight-color: transparent;
        }

        .top-nav {
            width: 100%;
            max-width: 500px;
            height: 54px;
            background-color: var(--nav-bg);
            display: flex;
            justify-content: space-around;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(0,0,0,0.2);
            box-sizing: border-box;
        }

        .nav-item {
            flex: 1;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 8px;
            transition: background 0.2s, color 0.2s;
            color: #72767d;
        }
        .nav-item:hover { background-color: rgba(255,255,255,0.05); color: var(--text-main); }
        .nav-item.active { color: var(--text-main); background-color: rgba(255,255,255,0.1); }
        .nav-icon { width: 26px; height: 26px; fill: currentColor; pointer-events: none; }

        .content-container { width: 100%; max-width: 500px; display: flex; flex-direction: column; align-items: center; padding-bottom: 20px; box-sizing: border-box; }
        .page { display: none; width: 100%; animation: fadeIn 0.3s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .profile-card { width: 100%; background-color: var(--card-bg); border-radius: 8px; margin-top: 15px; overflow: visible; box-shadow: 0 4px 6px rgba(0,0,0,0.1); box-sizing: border-box; position: relative; }
        .profile-header { padding: 15px; display: flex; align-items: flex-start; border-bottom: 1px solid var(--separator-color); position: relative; z-index: 10; }
        .avatar { width: 50px; height: 50px; border-radius: 50%; margin-right: 12px; object-fit: cover; border: 2px solid var(--separator-color); flex-shrink: 0; background-color: #000; }
        .info { flex: 1; overflow: visible; position: relative; }
        .player-name { font-size: 17px; margin: 0 0 5px 0; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: var(--text-main); }
        .user-id { font-size: 11px; color: var(--text-secondary); margin-bottom: 5px; }
        
        .class-wrapper { position: relative; width: 100%; z-index: 50; }
        .class-trigger { background: none; border: none; color: var(--text-secondary); font-size: 12px; padding: 4px 8px; margin: 0; cursor: pointer; text-transform: lowercase; font-family: inherit; display: inline-flex; align-items: center; gap: 4px; outline: none; text-align: left; border-radius: 4px; transition: background 0.2s; width: auto; }
        .class-trigger:hover { background-color: rgba(255,255,255,0.05); color: var(--text-main); }
        .class-trigger::after { content: '‚ñº'; font-size: 8px; transition: transform 0.2s; display: inline-block; }
        .class-trigger.open::after { transform: rotate(180deg); }
        
        .class-list { 
            display: none; 
            position: absolute; 
            top: 100%; 
            left: 0; 
            margin-top: 5px; 
            background-color: var(--input-bg); 
            border-radius: 4px; 
            overflow: hidden; 
            width: 100%; 
            max-height: 200px; 
            overflow-y: auto; 
            border: 1px solid var(--separator-color); 
            box-shadow: 0 8px 24px rgba(0,0,0,0.6); 
            z-index: 1000; 
        }
        .class-list.show { display: block; animation: fadeIn 0.2s; }
        
        .class-item { padding: 10px 12px; font-size: 13px; color: var(--text-main); text-transform: lowercase; cursor: pointer; border-bottom: 1px solid var(--separator-color); transition: background 0.1s; user-select: none; }
        .class-item:last-child { border-bottom: none; }
        .class-item:hover { background-color: rgba(255, 255, 255, 0.1); }
        .class-item.active { color: var(--accent); font-weight: 600; background-color: rgba(88, 101, 242, 0.15); }

        .stats-grid { width: 100%; display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; padding: 15px; box-sizing: border-box; }
        .stat-cell { background-color: transparent; border: none; border-radius: 0; padding: 8px 4px; display: flex; align-items: center; justify-content: center; cursor: pointer; position: relative; }
        .stat-cell:active, .stat-cell:hover { background-color: transparent; }
        .stat-row { display: flex; align-items: center; gap: 6px; pointer-events: none; width: 100%; justify-content: center; }
        .stat-icon { font-size: 18px; line-height: 1; flex-shrink: 0; text-align: center; width: 20px; }
        .stat-value-container { position: relative; min-width: 34px; display: flex; justify-content: center; align-items: center; }
        .stat-value { font-size: 14px; font-weight: 700; color: var(--text-main); padding: 0 2px; text-align: center; white-space: nowrap; line-height: 1.4; }
        .stat-label { font-size: 11px; color: var(--text-secondary); text-transform: lowercase; flex-shrink: 0; }
        .stat-input { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: var(--input-bg); border: 1px solid var(--accent); color: white; font-size: 14px; font-weight: 700; font-family: inherit; padding: 0; margin: 0; border-radius: 0; outline: none; text-align: center; line-height: 1.4; z-index: 20; box-sizing: border-box; appearance: none; -webkit-appearance: none; }
        .stat-input::-webkit-outer-spin-button, .stat-input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .stat-input[type=number] { -moz-appearance: textfield; }

        .class-result-box { width: 100%; padding: 0 15px; box-sizing: border-box; margin-bottom: 15px; }
        .result-card { background-color: transparent; border: none; border-radius: 0; padding: 12px 0 10px 0; display: flex; align-items: center; box-shadow: none; border-top: 1px solid var(--separator-color); margin-top: 5px; }
        .result-description { font-size: 13px; color: var(--text-secondary); line-height: 1.4; width: 100%; }
        .highlight-class { color: var(--text-main); font-weight: 700; font-size: 13px; margin-right: 4px; }
        .highlight-val { color: var(--text-secondary); font-weight: 600; }

        /* --- –°–¢–ò–õ–ò –î–õ–Ø –ü–û–ò–°–ö–ê –ò –°–û–†–¢–ò–†–û–í–ö–ò --- */
        .search-container {
            width: 100%;
            padding: 15px 15px 10px 15px;
            box-sizing: border-box;
            background-color: var(--bg-color);
            position: sticky;
            top: 54px;
            z-index: 90;
        }

        .search-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .search-input-wrapper {
            position: relative;
            flex: 1;
        }

        .search-input {
            width: 100%;
            background-color: var(--input-bg);
            border: 1px solid var(--separator-color);
            color: var(--text-main);
            font-size: 14px;
            padding: 10px 40px 10px 38px;
            border-radius: 6px;
            outline: none;
            transition: border-color 0.2s;
            box-sizing: border-box;
            font-family: inherit;
        }

        .search-input:focus {
            border-color: var(--accent);
        }

        .search-input::placeholder {
            color: var(--text-secondary);
            opacity: 0.6;
        }

        .search-icon {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            width: 18px;
            height: 18px;
            fill: var(--text-secondary);
            pointer-events: none;
        }

        .clear-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            width: 24px;
            height: 24px;
            background: transparent;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 0;
            transition: background 0.2s;
            z-index: 10;
        }

        .clear-btn.visible {
            display: flex;
        }

        .clear-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .clear-btn svg {
            width: 14px;
            height: 14px;
            fill: var(--text-secondary);
        }

        .clear-btn:hover svg {
            fill: var(--text-main);
        }

        .sort-btn {
            background-color: var(--input-bg);
            border: 1px solid var(--separator-color);
            color: var(--text-secondary);
            font-size: 13px;
            padding: 10px 12px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
            white-space: nowrap;
            font-family: inherit;
        }

        .sort-btn:hover {
            background-color: rgba(255,255,255,0.05);
            color: var(--text-main);
        }

        .sort-btn svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        .no-results {
            text-align: center;
            color: var(--text-secondary);
            padding: 20px;
            font-size: 14px;
            display: none;
        }

        .books-list { 
            width: 100%; 
            padding: 0 15px 15px 15px; 
            box-sizing: border-box; 
        }

        .book-item { 
            background-color: transparent;
            border: none; 
            border-radius: 0;
            padding: 12px 0;
            margin-bottom: 0; 
            display: flex; 
            flex-direction: column; 
            gap: 6px; 
            border-bottom: 1px dashed var(--separator-color);
        }

        .book-item:last-child {
            border-bottom: none;
        }

        .book-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            margin-bottom: 2px;
        }
        .book-name { 
            font-size: 15px; 
            font-weight: 700; 
            color: var(--text-main); 
            text-transform: none;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç–æ–≤ –≤ –∞–∫—Ç–∏–≤–Ω—ã—Ö —É–º–µ–Ω–∏—è—Ö */
        .stats-row {
            display: flex;
            gap: 12px;
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 4px;
            flex-wrap: wrap;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 3px;
        }
        
        .stat-icon-small {
            font-size: 14px;
        }
        
        .stat-value-small {
            color: var(--accent);
            font-weight: 600;
        }
        
        .book-desc { 
            font-size: 13px; 
            color: var(--text-secondary); 
            line-height: 1.4; 
            white-space: pre-line;
            margin-bottom: 4px;
            padding-right: 10px;
        }
        .book-val { 
            color: var(--text-main); 
            font-weight: 600; 
        }
        
        .book-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 2px;
            padding-top: 6px;
        }
        
        .book-level-wrapper {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .book-level-input {
            background: var(--input-bg);
            border: 1px solid var(--separator-color);
            color: white;
            font-size: 13px;
            font-weight: 700;
            padding: 4px 6px;
            border-radius: 4px;
            width: 55px;
            text-align: center;
            outline: none;
        }
        
        .book-level-input:focus {
            border-color: var(--accent);
        }
        
        .book-level-unit {
            color: var(--text-secondary);
            font-size: 13px;
        }
        
        .book-price { 
            color: var(--gold); 
            font-weight: 500;
            font-size: 13px;
        }

        .controls { width: 100%; padding: 0 15px 15px 15px; box-sizing: border-box; }
        .btn-reset { width: 100%; padding: 10px; background: transparent; color: #72767d; border: 1px solid #42454a; border-radius: 4px; font-size: 13px; font-weight: 600; cursor: pointer; margin-bottom: 8px; text-align: center; transition: all 0.2s; }
        .btn-reset:hover { background-color: rgba(255,255,255,0.05); color: var(--text-main); }
        .btn-reset:active { opacity: 0.6; }
        .btn-reset.danger { color: #ed4245; border-color: #ed4245; }
        .btn-reset.danger:hover { background-color: rgba(237, 66, 69, 0.1); }
    </style>
</head>
<body>

    <div class="top-nav">
        <!-- –ü–†–û–§–ò–õ–¨ (1) -->
        <div class="nav-item active" onclick="switchPage('profile')" id="nav-profile">
            <svg class="nav-icon" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
        </div>
        <!-- –ê–ö–¢–ò–í–ù–´–ï (2) -->
        <div class="nav-item" onclick="switchPage('active')" id="nav-active">
            <svg class="nav-icon" viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>
        </div>
        <!-- –ü–ê–°–°–ò–í–ù–´–ï (3) -->
        <div class="nav-item" onclick="switchPage('passive')" id="nav-passive">
            <svg class="nav-icon" viewBox="0 0 24 24"><path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-1 9h-4v4h-2v-4H9V9h4V5h2v4h4v2z"/></svg>
        </div>
    </div>

    <div class="content-container">
        
        <!-- –°–¢–†–ê–ù–ò–¶–ê –ü–†–û–§–ò–õ–Ø -->
        <div id="page-profile" class="page active">
            <div class="profile-card">
                <div class="profile-header">
                    <img src="https://via.placeholder.com/50" alt="Avatar" class="avatar" id="user-avatar">
                    <div class="info">
                        <h1 class="player-name" id="user-name">–ó–∞–≥—Ä—É–∑–∫–∞...</h1>
                        <div class="user-id" id="user-id"></div>
                        <div class="class-wrapper">
                            <button class="class-trigger" id="classTrigger" onclick="toggleClassList()">–∂–Ω–µ—Ü –¥—É—à</button>
                            <div class="class-list" id="classList"></div>
                        </div>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-cell" onclick="editStatByCell(this)"><div class="stat-row"><span class="stat-icon">üïØÔ∏è</span><div class="stat-value-container"><span class="stat-value" data-key="lvl">207</span></div><span class="stat-label">—É—Ä</span></div></div>
                    <div class="stat-cell" onclick="editStatByCell(this)"><div class="stat-row"><span class="stat-icon">‚öîÔ∏è</span><div class="stat-value-container"><span class="stat-value" data-key="atk">717</span></div><span class="stat-label">–∞—Ç–∫</span></div></div>
                    <div class="stat-cell" onclick="editStatByCell(this)"><div class="stat-row"><span class="stat-icon">üõ°Ô∏è</span><div class="stat-value-container"><span class="stat-value" data-key="armor">212</span></div><span class="stat-label">–±—Ä–Ω</span></div></div>
                    <div class="stat-cell" onclick="editStatByCell(this)"><div class="stat-row"><span class="stat-icon">üí™</span><div class="stat-value-container"><span class="stat-value" data-key="str">403</span></div><span class="stat-label">—Å–∏–ª</span></div></div>
                    <div class="stat-cell" onclick="editStatByCell(this)"><div class="stat-row"><span class="stat-icon">üëê</span><div class="stat-value-container"><span class="stat-value" data-key="agi">861</span></div><span class="stat-label">–ª–≤–∫</span></div></div>
                    <div class="stat-cell" onclick="editStatByCell(this)"><div class="stat-row"><span class="stat-icon">‚ù§Ô∏è</span><div class="stat-value-container"><span class="stat-value" data-key="vit">602</span></div><span class="stat-label">–≤–Ω—Å</span></div></div>
                    <div class="stat-cell" onclick="editStatByCell(this)"><div class="stat-row"><span class="stat-icon">üçÄ</span><div class="stat-value-container"><span class="stat-value" data-key="luck">57</span></div><span class="stat-label">—É–¥—á</span></div></div>
                    <div class="stat-cell" onclick="editStatByCell(this)"><div class="stat-row"><span class="stat-icon">üéØ</span><div class="stat-value-container"><span class="stat-value" data-key="acc">112</span></div><span class="stat-label">—Ç—á–Ω</span></div></div>
                    <div class="stat-cell" onclick="editStatByCell(this)"><div class="stat-row"><span class="stat-icon">üåÄ</span><div class="stat-value-container"><span class="stat-value" data-key="conc">64</span></div><span class="stat-label">–∫—Ü</span></div></div>
                    <div class="stat-cell" onclick="editStatByCell(this)"><div class="stat-row"><span class="stat-icon">üìú</span><div class="stat-value-container"><span class="stat-value" data-key="class_lvl">50</span></div><span class="stat-label">—É—Ä. –∫–ª.</span></div></div>
                    <div class="stat-cell" onclick="editStatByCell(this, true)"><div class="stat-row"><span class="stat-icon">üî∞</span><div class="stat-value-container"><span class="stat-value" data-key="resist">0%</span></div><span class="stat-label">—Å–æ–ø—Ä–∞</span></div></div>
                    <div class="stat-cell" onclick="editStatByCell(this, false, true)"><div class="stat-row"><span class="stat-icon" id="karma-icon">üòê</span><div class="stat-value-container"><span class="stat-value" data-key="karma">0</span></div><span class="stat-label">–∫–∞—Ä–º–∞</span></div></div>
                </div>

                <div class="class-result-box">
                    <div class="result-card">
                        <div class="result-description" id="res-class-desc"></div>
                    </div>
                </div>
            </div>
            <div class="controls"><button class="btn-reset danger" onclick="clearAll()">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë –≤—Ä—É—á–Ω—É—é</button></div>
        </div>

        <!-- –°–¢–†–ê–ù–ò–¶–ê –ê–ö–¢–ò–í–ù–´–• –£–ú–ï–ù–ò–ô -->
        <div id="page-active" class="page">
            <div class="search-container">
                <div class="search-controls">
                    <div class="search-input-wrapper">
                        <svg class="search-icon" viewBox="0 0 24 24">
                            <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                        </svg>
                        <input type="text" class="search-input" id="activeSearchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∞–∫—Ç–∏–≤–∫–∞–º..." oninput="handleActiveSearch()">
                        <button class="clear-btn" id="clearActiveSearchBtn" onclick="clearActiveSearch()" aria-label="–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫">
                            <svg viewBox="0 0 24 24">
                                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                            </svg>
                        </button>
                    </div>
                    
                    <button class="sort-btn" onclick="toggleActiveSort()" id="activeSortBtn" title="–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞">
                        <svg id="activeSortIconList" viewBox="0 0 24 24">
                            <path d="M3 18h6v-2H3v2zM3 6v2h18V6H3zm0 7h12v-2H3v2z"/>
                        </svg>
                        <svg id="activeSortIconAZ" viewBox="0 0 20 20" style="display: none;">
                            <path d="M8,11 C8.2821,11 8.54033,11.1583 8.66834,11.4097 C8.79635,11.661 8.77247,11.963 8.60656,12.1911 L5.47283,16.5 L8,16.5 C8.41422,16.5 8.75,16.8358 8.75,17.25 C8.75,17.6642 8.41422,18 8,18 L4,18 C3.71791,18 3.45967,17.8417 3.33167,17.5903 C3.20366,17.339 3.22753,17.037 3.39345,16.8089 L6.52718,12.5 L4,12.5 C3.58579,12.5 3.25,12.1642 3.25,11.75 C3.25,11.3358 3.58579,11 4,11 L8,11 Z M13.5000006,2 C13.9142,2 14.25,2.33579 14.25,2.75 L14.25,15.5241 L16.7383,13.2017 C17.0411,12.9191 17.5157,12.9355 17.7983,13.2383 C18.0809,13.5411 18.0646,14.0157 17.7617,14.2983 L14.0117,17.7983 C13.7236,18.0672 13.2764,18.0672 12.9883,17.7983 L9.23826,14.2983 C8.93545,14.0157 8.91909,13.5411 9.20171,13.2383 C9.48434,12.9355 9.95893,12.9191 10.2617,13.2017 L12.75,15.5241 L12.75,2.75 C12.75,2.33579 13.0858,2 13.5000006,2 Z M6.00002,2 C6.31967,2 6.6042,2.2026 6.70876,2.50467 L8.95876,9.00467 C9.09425,9.39609 8.88678,9.82325 8.49535,9.95874 C8.10393,10.0942 7.67677,9.88676 7.54128,9.49533 L7.19674,8.5 L4.8033,8.5 L4.45876,9.49533 C4.32327,9.88676 3.89611,10.0942 3.50469,9.95874 C3.11326,9.82325 2.90579,9.39609 3.04128,9.00467 L5.29128,2.50467 C5.39584,2.2026 5.68037,2 6.00002,2 Z M6.00002,5.0428 L5.32253,7 L6.67751,7 L6.00002,5.0428 Z"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="books-list" id="activeBooksContainer"></div>
            <div class="no-results" id="activeNoResultsMsg">–ê–∫—Ç–∏–≤–Ω—ã–µ —É–º–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>
        </div>

        <!-- –°–¢–†–ê–ù–ò–¶–ê –ü–ê–°–°–ò–í–ù–´–• –ö–ù–ò–ì -->
        <div id="page-passive" class="page">
            <div class="search-container">
                <div class="search-controls">
                    <div class="search-input-wrapper">
                        <svg class="search-icon" viewBox="0 0 24 24">
                            <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                        </svg>
                        <input type="text" class="search-input" id="passiveSearchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ –ø–∞—Å—Å–∏–≤–∫–∞–º..." oninput="handlePassiveSearch()">
                        <button class="clear-btn" id="clearPassiveSearchBtn" onclick="clearPassiveSearch()" aria-label="–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫">
                            <svg viewBox="0 0 24 24">
                                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                            </svg>
                        </button>
                    </div>
                    
                    <button class="sort-btn" onclick="togglePassiveSort()" id="passiveSortBtn" title="–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞">
                        <svg id="passiveSortIconList" viewBox="0 0 24 24">
                            <path d="M3 18h6v-2H3v2zM3 6v2h18V6H3zm0 7h12v-2H3v2z"/>
                        </svg>
                        <svg id="passiveSortIconAZ" viewBox="0 0 20 20" style="display: none;">
                            <path d="M8,11 C8.2821,11 8.54033,11.1583 8.66834,11.4097 C8.79635,11.661 8.77247,11.963 8.60656,12.1911 L5.47283,16.5 L8,16.5 C8.41422,16.5 8.75,16.8358 8.75,17.25 C8.75,17.6642 8.41422,18 8,18 L4,18 C3.71791,18 3.45967,17.8417 3.33167,17.5903 C3.20366,17.339 3.22753,17.037 3.39345,16.8089 L6.52718,12.5 L4,12.5 C3.58579,12.5 3.25,12.1642 3.25,11.75 C3.25,11.3358 3.58579,11 4,11 L8,11 Z M13.5000006,2 C13.9142,2 14.25,2.33579 14.25,2.75 L14.25,15.5241 L16.7383,13.2017 C17.0411,12.9191 17.5157,12.9355 17.7983,13.2383 C18.0809,13.5411 18.0646,14.0157 17.7617,14.2983 L14.0117,17.7983 C13.7236,18.0672 13.2764,18.0672 12.9883,17.7983 L9.23826,14.2983 C8.93545,14.0157 8.91909,13.5411 9.20171,13.2383 C9.48434,12.9355 9.95893,12.9191 10.2617,13.2017 L12.75,15.5241 L12.75,2.75 C12.75,2.33579 13.0858,2 13.5000006,2 Z M6.00002,2 C6.31967,2 6.6042,2.2026 6.70876,2.50467 L8.95876,9.00467 C9.09425,9.39609 8.88678,9.82325 8.49535,9.95874 C8.10393,10.0942 7.67677,9.88676 7.54128,9.49533 L7.19674,8.5 L4.8033,8.5 L4.45876,9.49533 C4.32327,9.88676 3.89611,10.0942 3.50469,9.95874 C3.11326,9.82325 2.90579,9.39609 3.04128,9.00467 L5.29128,2.50467 C5.39584,2.2026 5.68037,2 6.00002,2 Z M6.00002,5.0428 L5.32253,7 L6.67751,7 L6.00002,5.0428 Z"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="books-list" id="passiveBooksContainer"></div>
            <div class="no-results" id="passiveNoResultsMsg">–ü–∞—Å—Å–∏–≤–Ω—ã–µ –∫–Ω–∏–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>
        </div>
    </div>

    <script src="passives.js"></script>
    <script src="actives.js"></script>
    <script src="prices.js"></script>

    <script>
        const CLASS_CONFIG = {
            "–∂–Ω–µ—Ü –¥—É—à": { type: "warlock", name: "–ß–µ—Ä–Ω–æ–∫–Ω–∏–∂–Ω–∏–∫", desc: "<span class='highlight-class'>–ß–µ—Ä–Ω–æ–∫–Ω–∏–∂–Ω–∏–∫</span>: –î–æ–ø. —Å–Ω–∏–∂–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ –Ω–∞ <span class='highlight-val'>{val}%</span>" },
            "–ø–æ–≤–µ–ª–∏—Ç–µ–ª—å –º—Ä–∞–∫–∞": { type: "warlock", name: "–ß–µ—Ä–Ω–æ–∫–Ω–∏–∂–Ω–∏–∫", desc: "<span class='highlight-class'>–ß–µ—Ä–Ω–æ–∫–Ω–∏–∂–Ω–∏–∫</span>: –î–æ–ø. —Å–Ω–∏–∂–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ –Ω–∞ <span class='highlight-val'>{val}%</span>" },
            "–æ—Ç—Ä–µ–∫—à–∏–π—Å—è": { type: "vampire", name: "–ö—Ä–æ–≤–æ–ø–∏–π—Ü–∞", desc: "<span class='highlight-class'>–ö—Ä–æ–≤–æ–ø–∏–π—Ü–∞</span>: –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–¥–æ—Ä–æ–≤—å–µ –≤ —Ä–∞–∑–º–µ—Ä–µ <span class='highlight-val'>{val}%</span> –æ—Ç —É—Ä–æ–Ω–∞ –ø—Ä–æ—Å—Ç—ã–º–∏ –∞—Ç–∞–∫–∞–º–∏" },
            "–ø—Ä–æ–∫–∞–∂–µ–Ω–Ω—ã–π": { type: "vampire", name: "–ö—Ä–æ–≤–æ–ø–∏–π—Ü–∞", desc: "<span class='highlight-class'>–ö—Ä–æ–≤–æ–ø–∏–π—Ü–∞</span>: –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–¥–æ—Ä–æ–≤—å–µ –≤ —Ä–∞–∑–º–µ—Ä–µ <span class='highlight-val'>{val}%</span> –æ—Ç —É—Ä–æ–Ω–∞ –ø—Ä–æ—Å—Ç—ã–º–∏ –∞—Ç–∞–∫–∞–º–∏" },
            "–∫—Ä–µ—Å—Ç–æ–Ω–æ—Å–µ—Ü": { type: "paladin", name: "–ü–∞–ª–∞–¥–∏–Ω", desc: "<span class='highlight-class'>–ü–∞–ª–∞–¥–∏–Ω</span>: –®–∞–Ω—Å <span class='highlight-val'>{val}%</span>, —á—Ç–æ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —É—Ä–æ–Ω –æ—Ç –æ–±—ã—á–Ω–æ–π –∞—Ç–∞–∫–∏ –æ—Ç—Ä–∞–∑–∏—Ç—Å—è –≤ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ (–Ω–µ –¥–æ–±–∏–≤–∞–µ—Ç –≤ PvP)" },
            "–≤–æ–ø–ª–æ—â–µ–Ω–∏–µ —Å–≤–µ—Ç–∞": { type: "paladin", name: "–ü–∞–ª–∞–¥–∏–Ω", desc: "<span class='highlight-class'>–ü–∞–ª–∞–¥–∏–Ω</span>: –®–∞–Ω—Å <span class='highlight-val'>{val}%</span>, —á—Ç–æ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —É—Ä–æ–Ω –æ—Ç –æ–±—ã—á–Ω–æ–π –∞—Ç–∞–∫–∏ –æ—Ç—Ä–∞–∑–∏—Ç—Å—è –≤ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ (–Ω–µ –¥–æ–±–∏–≤–∞–µ—Ç –≤ PvP)" },
            "–∫–ª–∏–Ω–æ–∫ —Ç—å–º—ã": { type: "assassin", name: "–ê—Å—Å–∞—Å–∏–Ω", desc: "<span class='highlight-class'>–ê—Å—Å–∞—Å–∏–Ω</span>: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ <span class='highlight-val'>{val}%</span> —à–∞–Ω—Å–∞ —É–∫–ª–æ–Ω–∏—Ç—å—Å—è –æ—Ç –∞—Ç–∞–∫–∏" },
            "–∫–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π —É–±–∏–π—Ü–∞": { type: "assassin", name: "–ê—Å—Å–∞—Å–∏–Ω", desc: "<span class='highlight-class'>–ê—Å—Å–∞—Å–∏–Ω</span>: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ <span class='highlight-val'>{val}%</span> —à–∞–Ω—Å–∞ —É–∫–ª–æ–Ω–∏—Ç—å—Å—è –æ—Ç –∞—Ç–∞–∫–∏" },
            "–±–µ—Ä—Å–µ—Ä–∫–µ—Ä": { type: "executioner", name: "–ü–∞–ª–∞—á", desc: "<span class='highlight-class'>–ü–∞–ª–∞—á</span>: –ï—Å–ª–∏ —É –≤—Ä–∞–≥–∞ < {val}% –ù–† ‚Äî 50% —à–∞–Ω—Å –∫–∞–∑–Ω–∏ –±–µ–∑ –≤–æ–∑—Ä–æ–∂–¥–µ–Ω–∏—è" },
            "–ø–æ—Ç—Ä–æ—à–∏—Ç–µ–ª—å": { type: "executioner", name: "–ü–∞–ª–∞—á", desc: "<span class='highlight-class'>–ü–∞–ª–∞—á</span>: –ï—Å–ª–∏ —É –≤—Ä–∞–≥–∞ < {val}% –ù–† ‚Äî 50% —à–∞–Ω—Å –∫–∞–∑–Ω–∏ –±–µ–∑ –≤–æ–∑—Ä–æ–∂–¥–µ–Ω–∏—è" },
            "–∞–ø–æ—Å—Ç–æ–ª": { type: "secret_keeper", name: "–•—Ä–∞–Ω–∏—Ç–µ–ª—å —Ç–∞–π–Ω", desc: "<span class='highlight-class'>–•—Ä–∞–Ω–∏—Ç–µ–ª—å —Ç–∞–π–Ω</span>: –®–∞–Ω—Å {val}% –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ —É–º–µ–Ω–∏—è (-30% –ø—Ä–∏ –¥–æ–ø. –¥–µ–π—Å—Ç–≤–∏–∏)" },
            "–≤–µ—Ä—Ö–æ–≤–Ω—ã–π –º–∞–≥": { type: "secret_keeper", name: "–•—Ä–∞–Ω–∏—Ç–µ–ª—å —Ç–∞–π–Ω", desc: "<span class='highlight-class'>–•—Ä–∞–Ω–∏—Ç–µ–ª—å —Ç–∞–π–Ω</span>: –®–∞–Ω—Å {val}% –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ —É–º–µ–Ω–∏—è (-30% –ø—Ä–∏ –¥–æ–ø. –¥–µ–π—Å—Ç–≤–∏–∏)" }
        };

        const DB_KEY = 'rpg_stats_final_verified_v8';
        const DATE_KEY = 'rpg_date_final_verified_v8';
        const CLASS_KEY = 'rpg_class_final_verified_v8';
        const BOOKS_LVL_KEY = 'rpg_books_levels_final_verified_v8';
        const ACTIVE_BOOKS_LVL_KEY = 'rpg_active_books_levels_final_verified_v8';

        const triggerBtn = document.getElementById('classTrigger');
        const listDiv = document.getElementById('classList');
        const karmaIconSpan = document.getElementById('karma-icon');

        let passiveSortByAlphabet = false;
        let activeSortByAlphabet = false;

        function getKarmaIcon(value) {
            const num = parseInt(value);
            if (num < 0) return 'üòà';
            if (num === 0) return 'üòê';
            return 'üòá';
        }
        
        function updateKarmaIcon() {
            const karmaVal = document.querySelector('.stat-value[data-key="karma"]');
            if (karmaVal) {
                const val = parseInt(karmaVal.textContent) || 0;
                let displayVal = val;
                if (displayVal < -20) displayVal = -20;
                if (displayVal > 20) displayVal = 20;
                karmaIconSpan.textContent = getKarmaIcon(displayVal);
                if (val !== displayVal) karmaVal.textContent = displayVal;
            }
        }

        function calculateRunesResist(runesCount) {
            if (runesCount < 0) runesCount = 0;
            if (runesCount === 0) return 0;
            let resist = 10.0 * Math.pow(runesCount, 0.25);
            return Math.floor(resist);
        }

        function calculateClassEffect(type, level) {
            if (level < 1) level = 1;
            let coefficient = 5.0;
            let maxCap = 30.0;
            if (type === 'warlock' || type === 'vampire') {
                coefficient = 10.0;
                maxCap = 50.0;
            }
            let effect = coefficient * Math.sqrt(level / 1000.0) + 10.0;
            effect = Math.floor(effect * 10) / 10;
            return Math.min(maxCap, effect);
        }

        function updateClassResult() {
            const className = triggerBtn.textContent.trim();
            const classLvlInput = document.querySelector('.stat-value[data-key="class_lvl"]').textContent;
            const classLvl = parseInt(classLvlInput) || 1;
            const config = CLASS_CONFIG[className];
            
            if (!config) {
                document.getElementById('res-class-desc').innerHTML = "–ö–ª–∞—Å—Å –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω";
                return;
            }

            const bonus = calculateClassEffect(config.type, classLvl);
            document.getElementById('res-class-desc').innerHTML = config.desc.replace('{val}', bonus.toFixed(1));
        }

        window.toggleClassList = function() {
            const isShown = listDiv.classList.contains('show');
            if (isShown) {
                listDiv.classList.remove('show');
                triggerBtn.classList.remove('open');
            } else {
                listDiv.classList.add('show');
                triggerBtn.classList.add('open');
            }
        };

        window.selectClass = function(cls) {
            localStorage.setItem(CLASS_KEY, cls);
            localStorage.setItem(DATE_KEY, Date.now().toString());
            triggerBtn.textContent = cls;
            
            const items = listDiv.querySelectorAll('.class-item');
            items.forEach(item => {
                item.classList.toggle('active', item.textContent === cls);
            });

            listDiv.classList.remove('show');
            triggerBtn.classList.remove('open');
            
            updateClassResult();
        };

        function initClassList() {
            const saved = localStorage.getItem(CLASS_KEY) || "–∂–Ω–µ—Ü –¥—É—à";
            triggerBtn.textContent = saved;
            listDiv.innerHTML = '';

            Object.keys(CLASS_CONFIG).forEach(cls => {
                const div = document.createElement('div');
                div.className = 'class-item';
                if (cls === saved) div.classList.add('active');
                div.textContent = cls;
                
                div.onclick = function(e) {
                    e.stopPropagation();
                    selectClass(cls);
                };
                
                listDiv.appendChild(div);
            });
            
            updateClassResult();
        }

        document.addEventListener('click', function(e) {
            if (!listDiv.contains(e.target) && e.target !== triggerBtn) {
                listDiv.classList.remove('show');
                triggerBtn.classList.remove('open');
            }
        });

        async function loadVKUserData() {
            try {
                const user = await vkBridge.send('VKWebAppGetUserInfo');
                
                const avatar = document.getElementById('user-avatar');
                if (user.photo_200) {
                    avatar.src = user.photo_200;
                } else if (user.photo_100) {
                    avatar.src = user.photo_100;
                } else if (user.photo_50) {
                    avatar.src = user.photo_50;
                }
                
                const nameElement = document.getElementById('user-name');
                nameElement.textContent = `${user.first_name} ${user.last_name}`;
                
                const idElement = document.getElementById('user-id');
                idElement.textContent = `ID: ${user.id}`;
                
            } catch (error) {
                console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è VK', error);
                document.getElementById('user-name').textContent = '–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
            }
        }

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø–µ—Ä–µ—Ö–≤–∞—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º
        document.addEventListener('submit', function(event) {
            event.preventDefault();
            event.stopPropagation();
            return false;
        }, true);

        // --- –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ü–û–õ–£–ß–ï–ù–ò–Ø –°–¢–ê–¢–û–í –ò–ó –ü–†–û–§–ò–õ–Ø ---
        function getStatsFromProfile() {
            const stats = {};
            document.querySelectorAll('.stat-value').forEach(el => {
                stats[el.dataset.key] = el.textContent;
            });
            return {
                lvl: parseInt(stats.lvl) || 0,
                atk: parseInt(stats.atk) || 0,
                armor: parseInt(stats.armor) || 0,
                str: parseInt(stats.str) || 0,
                agi: parseInt(stats.agi) || 0,
                vit: parseInt(stats.vit) || 0,
                luck: parseInt(stats.luck) || 0,
                acc: parseInt(stats.acc) || 0,
                conc: parseInt(stats.conc) || 0,
                class_lvl: parseInt(stats.class_lvl) || 0,
                resist: parseInt(stats.resist) || 0,
                karma: parseInt(stats.karma) || 0
            };
        }

        // --- –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –†–ê–°–ß–ï–¢–ê –£–†–û–ù–ê –ê–ö–¢–ò–í–ù–û–ì–û –£–ú–ï–ù–ò–Ø ---
        function calculateActiveDamage(skillName, level, stats) {
            const skill = ACTIVE_SKILLS[skillName];
            if (!skill) return '?';
            
            try {
                // –ï—Å–ª–∏ —É —É–º–µ–Ω–∏—è –Ω–µ—Ç calc_damage, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –º–Ω–æ–∂–∏—Ç–µ–ª—å
                if (!skill.calc_damage) {
                    if (skill.calc) {
                        return skill.calc(level);
                    }
                    return '?';
                }
                
                // –†–∞—Å—á–µ—Ç –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º –∏–∑ skill.params
                const params = skill.params || [];
                
                if (params.length === 1) {
                    const param = params[0];
                    const value = stats[param] || 0;
                    return skill.calc_damage(level, value);
                } else if (params.length === 2) {
                    const param1 = params[0];
                    const param2 = params[1];
                    const value1 = stats[param1] || 0;
                    const value2 = stats[param2] || 0;
                    return skill.calc_damage(level, value1, value2);
                }
                
                // Fallback –Ω–∞ switch –µ—Å–ª–∏ params –Ω–µ –∑–∞–¥–∞–Ω—ã
                switch(skillName) {
                    case "–ì—Ä—è–∑–Ω—ã–π —É–¥–∞—Ä":
                        return skill.calc_damage(level, stats.agi, stats.str);
                    case "–°–ª–∞–±–æ–µ –∏—Å—Ü–µ–ª–µ–Ω–∏–µ":
                        return skill.calc_damage(level, stats.vit);
                    case "–£–¥–∞—Ä –≤–∞–º–ø–∏—Ä–∞":
                        return skill.calc_damage(level, stats.agi, stats.vit);
                    case "–ú–æ—â–Ω—ã–π —É–¥–∞—Ä":
                        return skill.calc_damage(level, stats.str, stats.atk);
                    case "–°–∏–ª–∞ —Ç–µ–Ω–µ–π":
                        return skill.calc_damage(level, stats.lvl);
                    case "–†–∞—Å–ø—Ä–∞–≤–∞":
                        return skill.calc_damage(level, stats.lvl);
                    case "–†–∞—Å—Å–µ—á–µ–Ω–∏–µ":
                        return skill.calc_damage(level, stats.atk, stats.agi);
                    case "–¢–∞—Ä–∞–Ω":
                        return skill.calc_damage(level, stats.armor);
                    case "–û–≥–æ–Ω–µ–∫ –Ω–∞–¥–µ–∂–¥—ã":
                        return skill.calc_damage(level, stats.vit);
                    case "–ö—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ":
                        return skill.calc_damage(level, stats.atk, stats.agi);
                    case "–ó–∞—Ä–∞–∂–µ–Ω–∏–µ":
                        return skill.calc_damage(level, stats.vit);
                    case "–†–∞—Å–∫–æ–ª":
                        return skill.calc_damage(level, stats.agi);
                    default:
                        return skill.calc ? skill.calc(level) : '?';
                }
            } catch (e) {
                console.log('–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –¥–ª—è', skillName, e);
                return '?';
            }
        }

        // --- –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ü–û–õ–£–ß–ï–ù–ò–Ø –°–¢–†–û–ö–ò –°–û –°–¢–ê–¢–ê–ú–ò ---
        function getStatsString(skillName, stats) {
            switch(skillName) {
                case "–ì—Ä—è–∑–Ω—ã–π —É–¥–∞—Ä":
                    return `<span class="stat-item"><span class="stat-icon-small">üëê</span> <span class="stat-value-small">${stats.agi}</span> | <span class="stat-icon-small">üí™</span> <span class="stat-value-small">${stats.str}</span></span>`;
                case "–°–ª–∞–±–æ–µ –∏—Å—Ü–µ–ª–µ–Ω–∏–µ":
                    return `<span class="stat-item"><span class="stat-icon-small">‚ù§Ô∏è</span> <span class="stat-value-small">${stats.vit}</span></span>`;
                case "–£–¥–∞—Ä –≤–∞–º–ø–∏—Ä–∞":
                    return `<span class="stat-item"><span class="stat-icon-small">üëê</span> <span class="stat-value-small">${stats.agi}</span> | <span class="stat-icon-small">‚ù§Ô∏è</span> <span class="stat-value-small">${stats.vit}</span></span>`;
                case "–ú–æ—â–Ω—ã–π —É–¥–∞—Ä":
                    return `<span class="stat-item"><span class="stat-icon-small">üí™</span> <span class="stat-value-small">${stats.str}</span> | <span class="stat-icon-small">‚öîÔ∏è</span> <span class="stat-value-small">${stats.atk}</span></span>`;
                case "–°–∏–ª–∞ —Ç–µ–Ω–µ–π":
                    return `<span class="stat-item"><span class="stat-icon-small">üïØÔ∏è</span> <span class="stat-value-small">${stats.lvl}</span></span>`;
                case "–†–∞—Å–ø—Ä–∞–≤–∞":
                    return `<span class="stat-item"><span class="stat-icon-small">üïØÔ∏è</span> <span class="stat-value-small">${stats.lvl}</span></span>`;
                case "–°–ª–µ–ø–æ—Ç–∞":
                    return `<span class="stat-item">–Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Å—Ç–∞—Ç–æ–≤</span>`;
                case "–†–∞—Å—Å–µ—á–µ–Ω–∏–µ":
                    return `<span class="stat-item"><span class="stat-icon-small">‚öîÔ∏è</span> <span class="stat-value-small">${stats.atk}</span> | <span class="stat-icon-small">üëê</span> <span class="stat-value-small">${stats.agi}</span></span>`;
                case "–ë–µ—Ä—Å–µ—Ä–∫–µ—Ä":
                    return `<span class="stat-item">–Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Å—Ç–∞—Ç–æ–≤</span>`;
                case "–¢–∞—Ä–∞–Ω":
                    return `<span class="stat-item"><span class="stat-icon-small">üõ°Ô∏è</span> <span class="stat-value-small">${stats.armor}</span></span>`;
                case "–ü—Ä–æ–∫–ª—è—Ç–∏–µ —Ç—å–º—ã":
                    return `<span class="stat-item"><span class="stat-icon-small">üïØÔ∏è</span> <span class="stat-value-small">${stats.lvl}</span></span>`;
                case "–û–≥–æ–Ω–µ–∫ –Ω–∞–¥–µ–∂–¥—ã":
                    return `<span class="stat-item"><span class="stat-icon-small">‚ù§Ô∏è</span> <span class="stat-value-small">${stats.vit}</span></span>`;
                case "–¶–µ–ª–µ–±–Ω—ã–π –æ–≥–æ–Ω—å":
                    return `<span class="stat-item"><span class="stat-icon-small">üïØÔ∏è</span> <span class="stat-value-small">${stats.lvl}</span></span>`;
                case "–ö—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ":
                    return `<span class="stat-item"><span class="stat-icon-small">‚öîÔ∏è</span> <span class="stat-value-small">${stats.atk}</span> | <span class="stat-icon-small">üëê</span> <span class="stat-value-small">${stats.agi}</span></span>`;
                case "–ó–∞—Ä–∞–∂–µ–Ω–∏–µ":
                    return `<span class="stat-item"><span class="stat-icon-small">‚ù§Ô∏è</span> <span class="stat-value-small">${stats.vit}</span></span>`;
                case "–†–∞—Å–∫–æ–ª":
                    return `<span class="stat-item"><span class="stat-icon-small">üëê</span> <span class="stat-value-small">${stats.agi}</span></span>`;
                default:
                    return '';
            }
        }

        // --- –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ü–û–õ–£–ß–ï–ù–ò–Ø –û–ü–ò–°–ê–ù–ò–Ø ---
        function getSkillDescription(skillName, level, stats) {
            const skill = ACTIVE_SKILLS[skillName];
            if (!skill) return skillName;
            
            let desc = skill.desc;
            const damage = calculateActiveDamage(skillName, level, stats);
            
            // –ó–∞–º–µ–Ω—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã
            desc = desc.replace('{damage}', `<span class="book-val">${damage}</span>`);
            
            // –î–ª—è –°–ª–∞–±–æ–≥–æ –∏—Å—Ü–µ–ª–µ–Ω–∏—è –¥–æ–±–∞–≤–ª—è–µ–º —Ç–æ—á–Ω–æ—Å—Ç—å
            if (skillName === "–°–ª–∞–±–æ–µ –∏—Å—Ü–µ–ª–µ–Ω–∏–µ" && skill.calc) {
                const mult = skill.calc(level);
                const accuracy = Math.floor(mult / 20);
                desc = desc.replace('{accuracy}', `<span class="book-val">${accuracy}</span>`);
            }
            
            // –î–ª—è –†–∞—Å–∫–æ–ª–∞
            if (skillName === "–†–∞—Å–∫–æ–ª") {
                const armorReduce = Math.floor((Math.sqrt(level*10)/100*0.5 + 1) * 30);
                desc = desc.replace('{armor_reduce}', `<span class="book-val">${armorReduce}</span>`);
            }
            
            return desc;
        }

        // --- –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ü–ê–°–°–ò–í–ù–´–• –ö–ù–ò–ì ---
        async function renderPassiveBooks() {
            const savedLevels = JSON.parse(localStorage.getItem(BOOKS_LVL_KEY) || '{}');
            const container = document.getElementById('passiveBooksContainer');
            container.innerHTML = '';
            
            let booksArray = Object.entries(PASSIVE_SKILLS);
            
            if (passiveSortByAlphabet) {
                booksArray.sort((a, b) => a[0].localeCompare(b[0], 'ru'));
            }
            
            for (const [name, data] of booksArray) {
                const lvl = savedLevels[name] || 1;
                let result = data.calc(lvl);
                let formatData;
                
                if (data.format) {
                    if (typeof data.format === 'function') {
                        formatData = data.format(result, lvl);
                    } else {
                        formatData = data.format;
                    }
                } else {
                    formatData = { result: result };
                }
                
                let desc = data.desc;
                
                for (const [key, val] of Object.entries(formatData)) {
                    const regex = new RegExp(`\\{${key}(?::\\.2f)?\\}`, 'g');
                    desc = desc.replace(regex, `<span class="book-val">${val}</span>`);
                }
                
                const item = document.createElement('div');
                item.className = 'book-item';
                item.dataset.bookName = name.toLowerCase();
                
                let priceText = '0';
                
                try {
                    const bookPrice = await getBookPrice(name);
                    if (bookPrice && bookPrice > 0) {
                        const totalCost = calculateUpgradeCost(lvl, bookPrice);
                        if (totalCost) {
                            priceText = formatGold(totalCost);
                        }
                    }
                } catch (e) {
                    console.log('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ü–µ–Ω—ã –¥–ª—è', name);
                }
                
                const headerDiv = document.createElement('div');
                headerDiv.className = 'book-header';
                const nameDiv = document.createElement('div');
                nameDiv.className = 'book-name';
                nameDiv.textContent = name;
                headerDiv.appendChild(nameDiv);
                
                const descDiv = document.createElement('div');
                descDiv.className = 'book-desc';
                descDiv.innerHTML = desc;
                
                const footerDiv = document.createElement('div');
                footerDiv.className = 'book-footer';
                
                const levelWrapper = document.createElement('div');
                levelWrapper.className = 'book-level-wrapper';
                
                const levelInput = document.createElement('input');
                levelInput.type = 'number';
                levelInput.className = 'book-level-input';
                levelInput.value = lvl;
                levelInput.min = '1';
                
                levelInput.setAttribute('form', 'off');
                levelInput.setAttribute('autocomplete', 'off');
                levelInput.setAttribute('autocorrect', 'off');
                levelInput.setAttribute('spellcheck', 'false');
                
                levelInput.addEventListener('keydown', function(event) {
                    if (event.key === 'Enter') {
                        event.preventDefault();
                        event.stopPropagation();
                        event.stopImmediatePropagation();
                        this.blur();
                        return false;
                    }
                }, true);
                
                levelInput.addEventListener('keypress', function(event) {
                    if (event.key === 'Enter') {
                        event.preventDefault();
                        event.stopPropagation();
                        return false;
                    }
                }, true);
                
                levelInput.addEventListener('keyup', function(event) {
                    if (event.key === 'Enter') {
                        event.preventDefault();
                        event.stopPropagation();
                        return false;
                    }
                }, true);
                
                levelInput.addEventListener('blur', function() {
                    updatePassiveBookLevel(name, this.value);
                });
                
                const levelUnit = document.createElement('span');
                levelUnit.className = 'book-level-unit';
                levelUnit.textContent = '—É—Ä.';
                
                levelWrapper.appendChild(levelInput);
                levelWrapper.appendChild(levelUnit);
                
                const priceDiv = document.createElement('div');
                priceDiv.className = 'book-price';
                priceDiv.innerHTML = `üåï ${priceText}`;
                
                footerDiv.appendChild(levelWrapper);
                footerDiv.appendChild(priceDiv);
                
                item.appendChild(headerDiv);
                item.appendChild(descDiv);
                item.appendChild(footerDiv);
                
                container.appendChild(item);
            }
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–æ–∏—Å–∫ –ø–æ—Å–ª–µ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏
            handlePassiveSearch();
        }

        function updatePassiveBookDescription(bookElement, bookName, level) {
            const data = PASSIVE_SKILLS[bookName];
            if (!data) return;
            
            let result = data.calc(level);
            let formatData;
            
            if (data.format) {
                if (typeof data.format === 'function') {
                    formatData = data.format(result, level);
                } else {
                    formatData = data.format;
                }
            } else {
                formatData = { result: result };
            }
            
            let desc = data.desc;
            
            for (const [key, val] of Object.entries(formatData)) {
                const regex = new RegExp(`\\{${key}(?::\\.2f)?\\}`, 'g');
                desc = desc.replace(regex, `<span class="book-val">${val}</span>`);
            }
            
            const descDiv = bookElement.querySelector('.book-desc');
            if (descDiv) {
                descDiv.innerHTML = desc;
            }
        }

        async function updatePassiveBookPrice(bookElement, bookName, level) {
            try {
                const bookPrice = await getBookPrice(bookName);
                if (bookPrice && bookPrice > 0) {
                    const totalCost = calculateUpgradeCost(level, bookPrice);
                    if (totalCost) {
                        const priceDiv = bookElement.querySelector('.book-price');
                        if (priceDiv) {
                            priceDiv.innerHTML = `üåï ${formatGold(totalCost)}`;
                        }
                    }
                }
            } catch (e) {
                console.log('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω—ã –¥–ª—è', bookName);
            }
        }

        window.updatePassiveBookLevel = function(name, value) {
            const savedLevels = JSON.parse(localStorage.getItem(BOOKS_LVL_KEY) || '{}');
            const newLevel = parseInt(value) || 1;
            
            if (savedLevels[name] === newLevel) return;
            
            savedLevels[name] = newLevel;
            localStorage.setItem(BOOKS_LVL_KEY, JSON.stringify(savedLevels));
            
            const items = document.querySelectorAll('#passiveBooksContainer .book-item');
            for (const item of items) {
                if (item.dataset.bookName === name.toLowerCase()) {
                    const input = item.querySelector('.book-level-input');
                    if (input && parseInt(input.value) !== newLevel) {
                        input.value = newLevel;
                    }
                    
                    updatePassiveBookDescription(item, name, newLevel);
                    updatePassiveBookPrice(item, name, newLevel);
                    break;
                }
            }
        };

        window.togglePassiveSort = function() {
            passiveSortByAlphabet = !passiveSortByAlphabet;
            
            const iconList = document.getElementById('passiveSortIconList');
            const iconAZ = document.getElementById('passiveSortIconAZ');
            
            if (passiveSortByAlphabet) {
                iconList.style.display = 'none';
                iconAZ.style.display = 'block';
            } else {
                iconList.style.display = 'block';
                iconAZ.style.display = 'none';
            }
            
            const searchInput = document.getElementById('passiveSearchInput');
            const currentQuery = searchInput ? searchInput.value : '';
            
            renderPassiveBooks().then(() => {
                if (searchInput) {
                    searchInput.value = currentQuery;
                    filterPassiveBooks();
                }
            });
        };

        window.handlePassiveSearch = function() {
            const input = document.getElementById('passiveSearchInput');
            const clearBtn = document.getElementById('clearPassiveSearchBtn');
            
            if (input.value.length > 0) {
                clearBtn.classList.add('visible');
            } else {
                clearBtn.classList.remove('visible');
            }
            
            filterPassiveBooks();
        };

        window.clearPassiveSearch = function() {
            const input = document.getElementById('passiveSearchInput');
            const clearBtn = document.getElementById('clearPassiveSearchBtn');
            
            input.value = '';
            clearBtn.classList.remove('visible');
            input.focus();
            
            filterPassiveBooks();
        };

        window.filterPassiveBooks = function() {
            const input = document.getElementById('passiveSearchInput');
            const query = input.value.toLowerCase().trim();
            
            const items = document.querySelectorAll('#passiveBooksContainer .book-item');
            let visibleCount = 0;

            items.forEach(item => {
                const name = item.dataset.bookName;
                
                if (name.startsWith(query)) {
                    item.style.display = 'flex';
                    visibleCount++;
                } else {
                    item.style.display = 'none';
                }
            });

            const noResultsMsg = document.getElementById('passiveNoResultsMsg');
            if (visibleCount === 0) {
                noResultsMsg.style.display = 'block';
            } else {
                noResultsMsg.style.display = 'none';
            }
        };

        // --- –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ê–ö–¢–ò–í–ù–´–• –£–ú–ï–ù–ò–ô ---
        async function renderActiveBooks() {
            const savedLevels = JSON.parse(localStorage.getItem(ACTIVE_BOOKS_LVL_KEY) || '{}');
            const container = document.getElementById('activeBooksContainer');
            container.innerHTML = '';
            
            let booksArray = Object.entries(ACTIVE_SKILLS);
            
            if (activeSortByAlphabet) {
                booksArray.sort((a, b) => a[0].localeCompare(b[0], 'ru'));
            }
            
            const stats = getStatsFromProfile();
            
            for (const [name, data] of booksArray) {
                const lvl = savedLevels[name] || 1;
                
                const desc = getSkillDescription(name, lvl, stats);
                const statsString = getStatsString(name, stats);
                
                const item = document.createElement('div');
                item.className = 'book-item';
                item.dataset.bookName = name.toLowerCase();
                
                let priceText = '0';
                
                try {
                    const bookPrice = await getBookPrice(name);
                    if (bookPrice && bookPrice > 0) {
                        const totalCost = calculateUpgradeCost(lvl, bookPrice);
                        if (totalCost) {
                            priceText = formatGold(totalCost);
                        }
                    }
                } catch (e) {
                    console.log('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ü–µ–Ω—ã –¥–ª—è', name);
                }
                
                const headerDiv = document.createElement('div');
                headerDiv.className = 'book-header';
                const nameDiv = document.createElement('div');
                nameDiv.className = 'book-name';
                nameDiv.textContent = name;
                headerDiv.appendChild(nameDiv);
                
                const descDiv = document.createElement('div');
                descDiv.className = 'book-desc';
                descDiv.innerHTML = desc;
                
                const statsDiv = document.createElement('div');
                statsDiv.className = 'stats-row';
                statsDiv.innerHTML = statsString;
                
                const footerDiv = document.createElement('div');
                footerDiv.className = 'book-footer';
                
                const levelWrapper = document.createElement('div');
                levelWrapper.className = 'book-level-wrapper';
                
                const levelInput = document.createElement('input');
                levelInput.type = 'number';
                levelInput.className = 'book-level-input';
                levelInput.value = lvl;
                levelInput.min = '1';
                
                levelInput.setAttribute('form', 'off');
                levelInput.setAttribute('autocomplete', 'off');
                levelInput.setAttribute('autocorrect', 'off');
                levelInput.setAttribute('spellcheck', 'false');
                
                levelInput.addEventListener('keydown', function(event) {
                    if (event.key === 'Enter') {
                        event.preventDefault();
                        event.stopPropagation();
                        event.stopImmediatePropagation();
                        this.blur();
                        return false;
                    }
                }, true);
                
                levelInput.addEventListener('keypress', function(event) {
                    if (event.key === 'Enter') {
                        event.preventDefault();
                        event.stopPropagation();
                        return false;
                    }
                }, true);
                
                levelInput.addEventListener('keyup', function(event) {
                    if (event.key === 'Enter') {
                        event.preventDefault();
                        event.stopPropagation();
                        return false;
                    }
                }, true);
                
                levelInput.addEventListener('blur', function() {
                    updateActiveBookLevel(name, this.value);
                });
                
                const levelUnit = document.createElement('span');
                levelUnit.className = 'book-level-unit';
                levelUnit.textContent = '—É—Ä.';
                
                levelWrapper.appendChild(levelInput);
                levelWrapper.appendChild(levelUnit);
                
                const priceDiv = document.createElement('div');
                priceDiv.className = 'book-price';
                priceDiv.innerHTML = `üåï ${priceText}`;
                
                footerDiv.appendChild(levelWrapper);
                footerDiv.appendChild(priceDiv);
                
                item.appendChild(headerDiv);
                item.appendChild(descDiv);
                if (statsString) {
                    item.appendChild(statsDiv);
                }
                item.appendChild(footerDiv);
                
                container.appendChild(item);
            }
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–æ–∏—Å–∫ –ø–æ—Å–ª–µ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏
            handleActiveSearch();
        }

        function updateActiveBookDescription(bookElement, bookName, level) {
            const stats = getStatsFromProfile();
            const desc = getSkillDescription(bookName, level, stats);
            const statsString = getStatsString(bookName, stats);
            
            const descDiv = bookElement.querySelector('.book-desc');
            if (descDiv) {
                descDiv.innerHTML = desc;
            }
            
            const statsDiv = bookElement.querySelector('.stats-row');
            if (statsDiv) {
                statsDiv.innerHTML = statsString;
            }
        }

        async function updateActiveBookPrice(bookElement, bookName, level) {
            try {
                const bookPrice = await getBookPrice(bookName);
                if (bookPrice && bookPrice > 0) {
                    const totalCost = calculateUpgradeCost(level, bookPrice);
                    if (totalCost) {
                        const priceDiv = bookElement.querySelector('.book-price');
                        if (priceDiv) {
                            priceDiv.innerHTML = `üåï ${formatGold(totalCost)}`;
                        }
                    }
                }
            } catch (e) {
                console.log('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω—ã –¥–ª—è', bookName);
            }
        }

        window.updateActiveBookLevel = function(name, value) {
            const savedLevels = JSON.parse(localStorage.getItem(ACTIVE_BOOKS_LVL_KEY) || '{}');
            const newLevel = parseInt(value) || 1;
            
            if (savedLevels[name] === newLevel) return;
            
            savedLevels[name] = newLevel;
            localStorage.setItem(ACTIVE_BOOKS_LVL_KEY, JSON.stringify(savedLevels));
            
            const items = document.querySelectorAll('#activeBooksContainer .book-item');
            for (const item of items) {
                if (item.dataset.bookName === name.toLowerCase()) {
                    const input = item.querySelector('.book-level-input');
                    if (input && parseInt(input.value) !== newLevel) {
                        input.value = newLevel;
                    }
                    
                    updateActiveBookDescription(item, name, newLevel);
                    updateActiveBookPrice(item, name, newLevel);
                    break;
                }
            }
        };

        window.toggleActiveSort = function() {
            activeSortByAlphabet = !activeSortByAlphabet;
            
            const iconList = document.getElementById('activeSortIconList');
            const iconAZ = document.getElementById('activeSortIconAZ');
            
            if (activeSortByAlphabet) {
                iconList.style.display = 'none';
                iconAZ.style.display = 'block';
            } else {
                iconList.style.display = 'block';
                iconAZ.style.display = 'none';
            }
            
            const searchInput = document.getElementById('activeSearchInput');
            const currentQuery = searchInput ? searchInput.value : '';
            
            renderActiveBooks().then(() => {
                if (searchInput) {
                    searchInput.value = currentQuery;
                    filterActiveBooks();
                }
            });
        };

        window.handleActiveSearch = function() {
            const input = document.getElementById('activeSearchInput');
            const clearBtn = document.getElementById('clearActiveSearchBtn');
            
            if (input.value.length > 0) {
                clearBtn.classList.add('visible');
            } else {
                clearBtn.classList.remove('visible');
            }
            
            filterActiveBooks();
        };

        window.clearActiveSearch = function() {
            const input = document.getElementById('activeSearchInput');
            const clearBtn = document.getElementById('clearActiveSearchBtn');
            
            input.value = '';
            clearBtn.classList.remove('visible');
            input.focus();
            
            filterActiveBooks();
        };

        window.filterActiveBooks = function() {
            const input = document.getElementById('activeSearchInput');
            const query = input.value.toLowerCase().trim();
            
            const items = document.querySelectorAll('#activeBooksContainer .book-item');
            let visibleCount = 0;

            items.forEach(item => {
                const name = item.dataset.bookName;
                
                if (name.startsWith(query)) {
                    item.style.display = 'flex';
                    visibleCount++;
                } else {
                    item.style.display = 'none';
                }
            });

            const noResultsMsg = document.getElementById('activeNoResultsMsg');
            if (visibleCount === 0) {
                noResultsMsg.style.display = 'block';
            } else {
                noResultsMsg.style.display = 'none';
            }
        };

        // --- –ù–ê–í–ò–ì–ê–¶–ò–Ø ---
        window.switchPage = function(pageName) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(`page-${pageName}`).classList.add('active');
            document.getElementById(`nav-${pageName}`).classList.add('active');
            
            if (pageName === 'passive') {
                renderPassiveBooks();
            } else if (pageName === 'active') {
                renderActiveBooks();
            }
        };

        function checkReset() {
            const last = localStorage.getItem(DATE_KEY);
            if (last && (Date.now() - parseInt(last) > 7 * 24 * 60 * 60 * 1000)) clearAll();
        }

        function saveStats() {
            const data = {};
            document.querySelectorAll('.stat-value').forEach(el => data[el.dataset.key] = el.textContent);
            localStorage.setItem(DB_KEY, JSON.stringify(data));
            localStorage.setItem(DATE_KEY, Date.now().toString());
            updateClassResult();
            updateKarmaIcon();
        }

        function loadStats() {
            const raw = localStorage.getItem(DB_KEY);
            if (!raw) return;
            const data = JSON.parse(raw);
            document.querySelectorAll('.stat-value').forEach(el => {
                if (data[el.dataset.key]) el.textContent = data[el.dataset.key];
            });
            updateClassResult();
            updateKarmaIcon();
        }

        window.clearAll = function() {
            if(confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã? –í—Å–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —Å–±—Ä–æ—à–µ–Ω—ã.')) {
                localStorage.removeItem(DB_KEY);
                localStorage.removeItem(DATE_KEY);
                localStorage.removeItem(CLASS_KEY);
                localStorage.removeItem(BOOKS_LVL_KEY);
                localStorage.removeItem(ACTIVE_BOOKS_LVL_KEY);
                location.reload();
            }
        }

        window.editStatByCell = function(cellElement, isResist = false, isKarma = false) {
            const valueContainer = cellElement.querySelector('.stat-value-container');
            const valueSpan = valueContainer.querySelector('.stat-value');
            let currentVal = valueSpan.textContent;
            const key = valueSpan.dataset.key;
            let cleanVal = currentVal;
            if (isResist) cleanVal = currentVal.replace('%', '');
            
            const input = document.createElement('input');
            input.type = 'number';
            input.value = cleanVal === '0' ? '' : cleanVal;
            input.className = 'stat-input';
            valueSpan.style.visibility = 'hidden'; 
            valueContainer.appendChild(input);
            input.focus();
            input.select();
            
            const finish = () => {
                let newVal = input.value;
                if (newVal === '') newVal = '0';
                let finalValue = newVal;
                
                if (isResist) {
                    const runes = parseFloat(newVal);
                    const percent = calculateRunesResist(runes);
                    finalValue = percent + '%';
                } else if (isKarma) {
                    let num = parseInt(newVal);
                    if (num < -20) num = -20;
                    if (num > 20) num = 20;
                    finalValue = num.toString();
                } else {
                    const num = parseFloat(newVal);
                    if (!isNaN(num)) finalValue = Math.floor(num).toString();
                    if (key === 'class_lvl' && parseInt(finalValue) < 1) finalValue = '1';
                }
                
                valueSpan.textContent = finalValue;
                valueSpan.style.visibility = 'visible';
                input.remove();
                if (isKarma) updateKarmaIcon();
                saveStats();
            };
            
            input.onblur = finish;
            input.onkeydown = e => { 
                if(e.key === 'Enter') {
                    e.preventDefault();
                    e.stopPropagation();
                    input.blur(); 
                    return false;
                }
            };
            input.onclick = e => e.stopPropagation();
        }

        window.onload = () => {
            checkReset();
            loadStats();
            initClassList();
            
            try {
                vkBridge.send('VKWebAppInit')
                    .then(() => {
                        console.log('VK Bridge –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ');
                        loadVKUserData();
                    })
                    .catch(error => {
                        console.log('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ VK Bridge:', error);
                        document.getElementById('user-name').textContent = '–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
                    });
            } catch (e) {
                console.log('VK Bridge –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω (–≤–æ–∑–º–æ–∂–Ω–æ, –∑–∞–ø—É—Å–∫ –≤–Ω–µ VK)');
                document.getElementById('user-name').textContent = '–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
            }
        };
    </script>
</body>
</html>
